<root>
    <in>
        position3f
        texcoord2f
        normal_tangent
    </in>
    <out>
        position4f
        texcoord2f
        tangentmap
    </out>
    <uniform>
        PhongLight light;
        CameraInfo camera;
        MVPMatrix mvp;
    </uniform>

    <main>
        out_Position=mvp.l2w*vec4(Position,1.0);
        out_TexCoord=TexCoord;

        vec3 T=normalize(mat3(camera.normal)*Tangent);
        vec3 N=normalize(mat3(camera.normal)*Normal);
        T = normalize(T - dot(T, N) * N);    
        vec3 B = cross(N, T);    
        mat3 TBN = transpose(mat3(T, B, N));

        out_TangentLightPos = TBN * light.position;
        out_TangentViewPos  = TBN * camera.pos;
        out_TangentFragPos  = TBN * out_Position.xyz;

        gl_Position=camera.vp*out_Position;
    </main>
</root>
